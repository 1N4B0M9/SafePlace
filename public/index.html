<!DOCTYPE html>
<html>
  <head>
    <title>Guardian Pin</title>
    <link rel="shortcut icon" type="image/png" href="https://github.com/user-attachments/assets/9da70c57-1d11-4778-a9ed-ce04d55dcd43">
    <link rel="stylesheet" href="style.css">

    <style>
      /* map size */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }


      #map {
        height: 100%;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }

      /* form style */
      #crime-form {
        display: none;
        margin-top: 10px;
      }

      body {
            background-color: #153040;
            color: #fda300;
            font-family: 'Poppins', sans-serif;
            font-weight: bold;
            font-size: 0.8rem;
        }
      
      #title {
          font-size: 3rem;
          font-weight: black;
      }
      /* Legend styles */
      #legend {
        background-color: #fff;
        padding: 10px;
        font-size: 1rem;
        border-radius: 8px;
        position: absolute;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      #legend h4 {
        margin: 0;
        padding-bottom: 5px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }

      .legend-color {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        margin-right: 10px;
      }
      
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlJzZPVSJwtk99JUKoshFwG8K96ppJHak&callback=initMap" async defer></script>
    <script>
      let map;
      let selectedLocation = null;

      function initMap() {
        
        const centerCoords = { lat: 40.4321, lng: -79.9585 }; // Default center (Oakland)

        // Map style
        const customMapStyle = [ 
          {
            "elementType": "geometry",
            "stylers": [{ "color": "#2d2d2d" }] // Background land color
          },
          {
            "elementType": "labels.text.fill",
            "stylers": [{ "color": "#000000" }] // Labels color using your specified hex
          },
          {
            "featureType": "road",
            "elementType": "geometry",
            "stylers": [{ "color": "#DAA317" }] // Road color
          },
          {
            "featureType": "water",
            "elementType": "geometry.fill",
            "stylers": [{ "color": "#1d2c4d" }] // Water color
          },
          {
            "featureType": "poi.park",
            "elementType": "geometry",
            "stylers": [{ "color": "#383838" }] // Parks color
          }
        ];

        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center: centerCoords,
          styles: customMapStyle,
          streetViewControl: false,
          mapTypeControl: false,
          fullscreenControl: false
        });
        const legend = document.createElement('div');
        legend.id = 'legend';
        legend.style.backgroundColor = '#383838';
        legend.innerHTML = `
        <h4>Legend</h4>
        <div class="legend-item"><span class="legend-color" style="background-color: #F1C40F;"></span>Race</div>
        <div class="legend-item"><span class="legend-color" style="background-color: #FF5733;"></span>Religion</div>
        <div class="legend-item"><span class="legend-color" style="background-color: #8E44AD;"></span>Gender Identity</div>
        <div class="legend-item"><span class="legend-color" style="background-color: #3498DB;"></span>Sexual Orientation</div>
        <div class="legend-item"><span class="legend-color" style="background-color: #27AE60;"></span>Ethnicity</div>
        <div class="legend-item"><span class="legend-color" style="background-color: #E67E22;"></span>Disability</div>
       `;

       map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(legend);

        // Fetch reports and plot markers
       fetch('/reports')
              .then(response => {
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  return response.json();
                })
                .then(reports => {
                    reports.forEach(report => {
                        const position = { lat: parseFloat(report.lat), lng: parseFloat(report.lng) };
                        
                        let markerColor;
                        switch (report.category) {
                          case 'Race':
                            markerColor = '#F1c40F';
                            break;
                          case 'Religion':
                            markerColor = '#FF5733';
                            break;
                          case 'Gender Identity':
                            markerColor = '#8E44AD';
                            break;
                          case 'Sexual Orientation':
                            markerColor = '#3498DB';
                            break;
                          case 'Ethnicity':
                            markerColor = '#27AE60';
                            break;
                          case 'Disability':
                            markerColor = '#E67E22';
                            break;
                          default:
                            markerColor = '#000000'
                        }

                        const marker = new google.maps.Marker({
                            position: position,
                            map: map,
                            icon: {
                              path: google.maps.SymbolPath.CIRCLE,
                              scale: 8,
                              fillColor: markerColor,
                              fillOpacity: 1,
                              fillOpacity: 1,
                              strokeWeight: 1,
                              strokeColor: '#FFFFFF'

                            },
                            title: report.description // Tooltip on marker
                        });

                        // Create an InfoWindow for the marker
                        const infoWindow = new google.maps.InfoWindow({
                            content: `<div>
                                <strong>Description:</strong> ${report.description}<br>
                                <strong>Date:</strong> ${new Date(report.date).toLocaleDateString()}<br>
                                <strong>Category:</strong> ${report.category}<br>
                                <strong>Location:</strong> (${report.lat}, ${report.lng})
                            </div>`
                        });

                        // Add a click listener to the marker to open the InfoWindow
                        marker.addListener('click', () => {
                            infoWindow.open(map, marker);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error fetching reports:', error);
                });
              

        
      }
    
      function submitCrime() {
    const reportData = {
      description: document.getElementById('description').value,
      date: document.getElementById('date').value,
      category: document.getElementById('category').value,
      lat: document.getElementById('lat').value,
      lng: document.getElementById('lng').value,
    };

    fetch('/report', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(reportData),
    })
    .then(response => response.json())
    .then(data => {
      alert(data.message);
      // Reset the form and hide it
      document.getElementById('crime-form').reset();
      document.getElementById('crime-form').style.display = 'none';
      if (selectedLocation) {
        selectedLocation.setMap(null); // Remove marker after submission
        selectedLocation = null;
      }
    })
    .catch(error => {
      console.error('Error submitting report:', error);
    });
  }
  
    </script>
  </head>
  <body>
    <div class="nav-container">
      <a href="/">Home</a>
      <div class="right-links">
          <a href="reports.html">Directories</a>
          <a href="reports.html" id="reportButton">Report</a>
      </div>
  </div>



    <div id="map"></div>
    <h3>Loading...</h3>

    <!-- Form to report hate crime -->
   
    </div>
  </body>
</html>